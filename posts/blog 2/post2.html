<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aniket Adhikari">
<meta name="dcterms.date" content="2023-11-15">

<title>aniketadhikari.github.io ML Blog - Clustering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">aniketadhikari.github.io ML Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/aniketadhikari" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/aniket-adhikari" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Clustering</h1>
            <p class="subtitle lead">Using Python to Group Data Based on Similarities</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Aniket Adhikari </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 15, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">November 16, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#supervised-learning-vs.-unsupervised-learning" id="toc-supervised-learning-vs.-unsupervised-learning" class="nav-link active" data-scroll-target="#supervised-learning-vs.-unsupervised-learning">Supervised Learning vs.&nbsp;Unsupervised Learning</a></li>
  <li><a href="#what-is-clustering" id="toc-what-is-clustering" class="nav-link" data-scroll-target="#what-is-clustering">What is Clustering?</a></li>
  <li><a href="#how-does-clustering-work" id="toc-how-does-clustering-work" class="nav-link" data-scroll-target="#how-does-clustering-work">How Does Clustering Work?</a></li>
  <li><a href="#clustering-use-cases" id="toc-clustering-use-cases" class="nav-link" data-scroll-target="#clustering-use-cases">Clustering Use Cases</a></li>
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a>
  <ul class="collapse">
  <li><a href="#process-of-k-means-clustering" id="toc-process-of-k-means-clustering" class="nav-link" data-scroll-target="#process-of-k-means-clustering">Process of K-Means Clustering?</a></li>
  <li><a href="#choosing-the-number-of-clusters-k" id="toc-choosing-the-number-of-clusters-k" class="nav-link" data-scroll-target="#choosing-the-number-of-clusters-k">Choosing the Number of Clusters <span class="math inline">\(k\)</span></a></li>
  <li><a href="#example-of-k-means-clustering" id="toc-example-of-k-means-clustering" class="nav-link" data-scroll-target="#example-of-k-means-clustering">Example of K-Means Clustering</a></li>
  </ul></li>
  <li><a href="#gaussian-mixture-models-gmms" id="toc-gaussian-mixture-models-gmms" class="nav-link" data-scroll-target="#gaussian-mixture-models-gmms">Gaussian Mixture Models (GMMs)</a>
  <ul class="collapse">
  <li><a href="#how-does-gmms-work" id="toc-how-does-gmms-work" class="nav-link" data-scroll-target="#how-does-gmms-work">How Does GMMs Work</a></li>
  <li><a href="#example-of-gmm" id="toc-example-of-gmm" class="nav-link" data-scroll-target="#example-of-gmm">Example of GMM</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="supervised-learning-vs.-unsupervised-learning" class="level1">
<h1>Supervised Learning vs.&nbsp;Unsupervised Learning</h1>
<p>Before we talk about clustering, we must address some integral concepts related to it: supervised and unsupervised learning.</p>
<p><em>Supervised learning</em> is a machine learning technique that is used to train/teach a machine using <strong>labeled</strong> data. Labeled data implies that the data is already tagged with the correct answer. Teaching the machine on labeled data allows for future data to be correctly predicted. Under the umbrella of supervised learning, there are 2 categories of algorithms:</p>
<ul>
<li><strong>Classification</strong>: Output variable is a category, so we are looking to categorize the output</li>
<li><strong>Regression</strong>: Output variable is a real value, so we are looking to predict the value of the output</li>
</ul>
<p><em>Unsupervised Learning</em> is a machine learning technique that uses used to train/teach a machine using that isn’t labeled or classified. The machine is now responsible for grouping the data according to similarities in characteristics without prior training. This is much harder because there is no “teacher” here, meaning the machine is tasked with finding the hidden structure in the unlabeled data. Under the umbrella of unsupervised learning, there are 2 categories of algorithms:</p>
<ul>
<li><strong>Clustering</strong>: Grouping of cata to find similarities</li>
<li><strong>Association</strong>: Discover riles that describe large portions of data</li>
</ul>
<table class="table">
<caption>Comparison of Supervised and Unsupervised Learning</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Supervised Learning</th>
<th>Unsupervised Learning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Input</td>
<td>Labeled Data</td>
<td>Unlabeled, uncategorized</td>
</tr>
<tr class="even">
<td>Accuracy</td>
<td>Highly accurate</td>
<td>Less acurate</td>
</tr>
<tr class="odd">
<td>Output</td>
<td>Categorized or real values</td>
<td>Groupings</td>
</tr>
</tbody>
</table>
</section>
<section id="what-is-clustering" class="level1">
<h1>What is Clustering?</h1>
<p>As mentioned, clustering is a type of unsupervised learning. Here, we are grouping data so that each group, or cluster, exhibits similar qualities. Ultimately, the goal of clustering to uncover intrinsic patterns and structures within data that can be used for analysis.</p>
</section>
<section id="how-does-clustering-work" class="level1">
<h1>How Does Clustering Work?</h1>
<p>Algorithms that are focused on clustering measure similarity between data points across a set of features. Features should be continuous variables but can be categorical. However, categorical data needs special encoding. Data points in the cluster that appear close to each other based on the features are grouped together, which the data points that are far away are separated into different clusters. There are several approaches to clustering, including:</p>
<ul>
<li><strong>K-Means</strong>: Grouping of data points in K clusters by minimizing the intra-cluster sum-of-squares. This requires setting the number of clusters up front, as we’ll see in the application section.</li>
<li><strong>Hierarchial</strong>: Hierarchy of clusters are built iteratively</li>
<li><strong>DBSCAN</strong>: groups dense regions of points and considers the sparse areas as outliers. Intuitively detects arbitrary cluster shapes.</li>
<li><strong>Gaussian Mixture Models</strong>: Fits data as a mixture of Gaussian distributions where clusters are modeled using mean and covariance parameters.</li>
</ul>
</section>
<section id="clustering-use-cases" class="level1">
<h1>Clustering Use Cases</h1>
<p>So when is it a good time to use clustering? As mentioned, the best time to use clustering would be when we have data that is unlabeled. The following are more specific reasons to use clustering</p>
<ol type="1">
<li><strong>Exploratory Data Analysis</strong>: Clustering can help to reveal intrinsic groups and patterns in data without prior knowledge. It can open the door for further analysis by uncovering segements that were previously unknown</li>
<li><strong>Customer Segementation</strong>: Cluster customers based on certain attributes like demographics, purchasing beahvior, and more to achieve targeted marketing</li>
<li><strong>Social Network Analysis</strong>: Identify communities within a social network by clustering nodes based on connectivity and usage patterns</li>
<li><strong>Anomaly Detection</strong>: Detect anomalous data points that might not fit into a cluster to detect potential fraud or network attacks.</li>
</ol>
</section>
<section id="k-means-clustering" class="level1">
<h1>K-Means Clustering</h1>
<p>K-Means is one of the most popular clustering algorithms that is used for discovering intrinsic groups in unlabeled data. The</p>
<p>K-Means partitions a dataset into a predefined number of clusters, <span class="math inline">\(k\)</span>. It does this by minimizing the sum of distances between each data point and its assigned centroid, also known as the within-cluster sum of squares (WCSS).</p>
<section id="process-of-k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="process-of-k-means-clustering">Process of K-Means Clustering?</h2>
<ol type="1">
<li>Select <span class="math inline">\(k\)</span> initial centroids for the clusters</li>
<li>Assign each data point to its closest centroid point based on Euclidean distance</li>
<li>Recompute the centroids as the mean of all data points assigned to that cluster</li>
<li>Repeat steps 2-3 until convergence, meaning the centrods no longer change between iterations</li>
</ol>
</section>
<section id="choosing-the-number-of-clusters-k" class="level2">
<h2 class="anchored" data-anchor-id="choosing-the-number-of-clusters-k">Choosing the Number of Clusters <span class="math inline">\(k\)</span></h2>
<p>When choosing the number of clusters for K-Means it’s important to choose the right number of clusters because it affects the quality of clustering.</p>
<p>You could simply try different integer values to represent <span class="math inline">\(k\)</span> through a process of guessing-and-checking. Then, you could examine which one of <span class="math inline">\(k\)</span> values produces clustering visuals that makes the most sense for your data.</p>
<p>Another way to select <span class="math inline">\(k\)</span> is the <em>elbow method</em>, which involves plotting the WCSS vs.&nbsp;<span class="math inline">\(k\)</span>. The part of the curve that is shaped like an elbow will contain what is likely a good choice for the <span class="math inline">\(k\)</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.oreilly.com/api/v2/epubs/9781788295758/files/assets/995b8b58-06f1-4884-a2a1-f3648428e947.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Elbow Method from O’Reilly</figcaption>
</figure>
</div>
<p>There is also the <em>silhouette method</em>, which measures how well each data point fits into its assigned cluster compared to other clusters and selects the <span class="math inline">\(k\)</span> with the highest average silhouette score.</p>
</section>
<section id="example-of-k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="example-of-k-means-clustering">Example of K-Means Clustering</h2>
<p>We can actually apply K-Means clustering in Python. Similar to the last post, I want to demonstrate how that can be done in code using a dataset of Pokemon from Generations 1-7.</p>
<p>First we can start off by importing the libraries that are needed for the code. In addition to the same libraries from the previous post, <code>pandas</code> and <code>matplotlib</code>, we are going to import <code>numpy</code> as well as <code>KMeans</code> from <code>sklearn.cluster</code>.</p>
<p><code>numpy</code> will simply be used for transforming a python array of colors into something that can be used for designating clusters to be of certain colors.</p>
<p><code>KMeans</code> will be used for the actual clustering.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are then going to want to load our data. Again, it’s from the Pokemon dataset and it’s comma-separated.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"../../datasets/pokemon.csv"</span>, sep<span class="op">=</span><span class="st">","</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">attack</th>
<th data-quarto-table-cell-role="th">base_egg_steps</th>
<th data-quarto-table-cell-role="th">base_happiness</th>
<th data-quarto-table-cell-role="th">base_total</th>
<th data-quarto-table-cell-role="th">capture_rate</th>
<th data-quarto-table-cell-role="th">defense</th>
<th data-quarto-table-cell-role="th">experience_growth</th>
<th data-quarto-table-cell-role="th">height_m</th>
<th data-quarto-table-cell-role="th">hp</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">percentage_male</th>
<th data-quarto-table-cell-role="th">pokedex_number</th>
<th data-quarto-table-cell-role="th">sp_attack</th>
<th data-quarto-table-cell-role="th">sp_defense</th>
<th data-quarto-table-cell-role="th">speed</th>
<th data-quarto-table-cell-role="th">type1</th>
<th data-quarto-table-cell-role="th">type2</th>
<th data-quarto-table-cell-role="th">weight_kg</th>
<th data-quarto-table-cell-role="th">generation</th>
<th data-quarto-table-cell-role="th">is_legendary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>49</td>
<td>5120</td>
<td>70</td>
<td>318</td>
<td>45</td>
<td>49</td>
<td>1059860</td>
<td>0.7</td>
<td>45</td>
<td>Bulbasaur</td>
<td>88.1</td>
<td>1</td>
<td>65</td>
<td>65</td>
<td>45</td>
<td>grass</td>
<td>poison</td>
<td>6.9</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>62</td>
<td>5120</td>
<td>70</td>
<td>405</td>
<td>45</td>
<td>63</td>
<td>1059860</td>
<td>1.0</td>
<td>60</td>
<td>Ivysaur</td>
<td>88.1</td>
<td>2</td>
<td>80</td>
<td>80</td>
<td>60</td>
<td>grass</td>
<td>poison</td>
<td>13.0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100</td>
<td>5120</td>
<td>70</td>
<td>625</td>
<td>45</td>
<td>123</td>
<td>1059860</td>
<td>2.0</td>
<td>80</td>
<td>Venusaur</td>
<td>88.1</td>
<td>3</td>
<td>122</td>
<td>120</td>
<td>80</td>
<td>grass</td>
<td>poison</td>
<td>100.0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>52</td>
<td>5120</td>
<td>70</td>
<td>309</td>
<td>45</td>
<td>43</td>
<td>1059860</td>
<td>0.6</td>
<td>39</td>
<td>Charmander</td>
<td>88.1</td>
<td>4</td>
<td>60</td>
<td>50</td>
<td>65</td>
<td>fire</td>
<td>NaN</td>
<td>8.5</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>64</td>
<td>5120</td>
<td>70</td>
<td>405</td>
<td>45</td>
<td>58</td>
<td>1059860</td>
<td>1.1</td>
<td>58</td>
<td>Charmeleon</td>
<td>88.1</td>
<td>5</td>
<td>80</td>
<td>65</td>
<td>80</td>
<td>fire</td>
<td>NaN</td>
<td>19.0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">796</td>
<td>101</td>
<td>30720</td>
<td>0</td>
<td>570</td>
<td>25</td>
<td>103</td>
<td>1250000</td>
<td>9.2</td>
<td>97</td>
<td>Celesteela</td>
<td>NaN</td>
<td>797</td>
<td>107</td>
<td>101</td>
<td>61</td>
<td>steel</td>
<td>flying</td>
<td>999.9</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">797</td>
<td>181</td>
<td>30720</td>
<td>0</td>
<td>570</td>
<td>255</td>
<td>131</td>
<td>1250000</td>
<td>0.3</td>
<td>59</td>
<td>Kartana</td>
<td>NaN</td>
<td>798</td>
<td>59</td>
<td>31</td>
<td>109</td>
<td>grass</td>
<td>steel</td>
<td>0.1</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">798</td>
<td>101</td>
<td>30720</td>
<td>0</td>
<td>570</td>
<td>15</td>
<td>53</td>
<td>1250000</td>
<td>5.5</td>
<td>223</td>
<td>Guzzlord</td>
<td>NaN</td>
<td>799</td>
<td>97</td>
<td>53</td>
<td>43</td>
<td>dark</td>
<td>dragon</td>
<td>888.0</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">799</td>
<td>107</td>
<td>30720</td>
<td>0</td>
<td>600</td>
<td>3</td>
<td>101</td>
<td>1250000</td>
<td>2.4</td>
<td>97</td>
<td>Necrozma</td>
<td>NaN</td>
<td>800</td>
<td>127</td>
<td>89</td>
<td>79</td>
<td>psychic</td>
<td>NaN</td>
<td>230.0</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">800</td>
<td>95</td>
<td>30720</td>
<td>0</td>
<td>600</td>
<td>3</td>
<td>115</td>
<td>1250000</td>
<td>1.0</td>
<td>80</td>
<td>Magearna</td>
<td>NaN</td>
<td>801</td>
<td>130</td>
<td>115</td>
<td>65</td>
<td>steel</td>
<td>fairy</td>
<td>80.5</td>
<td>7</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>801 rows × 20 columns</p>
</div>
</div>
</div>
<p>Recall that clustering requires features to be <strong>continuous variables</strong>. In this dataset, we have a couple of different continuous variables, such as:</p>
<ul>
<li><code>attack</code></li>
<li><code>defense</code></li>
<li><code>base_total</code></li>
<li><code>sp_attack</code></li>
<li><code>sp_defense</code></li>
<li><code>height_m</code></li>
<li><code>percentage_male</code></li>
<li><code>speed</code></li>
<li><code>weight_kg</code></li>
</ul>
<p>Some of these variables are kind of useless though because they aren’t going to give us anything interesting. Instead we want to focus on the stats associated with each Pokemon. More specifically, we want to focus on</p>
<ul>
<li><code>attack</code></li>
<li><code>defense</code></li>
<li><code>sp_attack</code></li>
<li><code>sp_defense</code></li>
</ul>
<p>Honestly, I had trouble trying to decide on whether I wanted to cluster based on <code>attack</code> and <code>defense</code> or <code>sp_attack</code> and <code>sp_defense</code>. As a result, I ended up combining them in a way so that <code>attack</code> and <code>sp_attack</code> add up to <code>total_attack</code> and <code>defense</code> and <code>sp_defense</code> add up to <code>total_defense</code>.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Total Attack'</span>] <span class="op">=</span> data[<span class="st">'attack'</span>] <span class="op">+</span> data[<span class="st">'sp_attack'</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Total Defense'</span>] <span class="op">=</span> data[<span class="st">'defense'</span>] <span class="op">+</span> data[<span class="st">'sp_defense'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are storing data for <code>total_attack</code> and <code>total_defense</code> into variable <code>X</code></p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x_val <span class="op">=</span> <span class="st">'Total Attack'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> <span class="st">'Total Defense'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [x_val, y_val]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[values] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After we have our data, we need to determine the number of clusters, or <span class="math inline">\(k\)</span>. This is up to you, but I wanted to cluster it by 3 so we can have clusters of <strong>weak</strong>, <strong>intermediate</strong>, and <strong>strong</strong>.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then need to compute the K-Means clusters by using the <code>fit()</code> function. Here we supply the method with the data that was gathered earlier.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>kmeans.fit(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KMeans(n_clusters=3)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">KMeans</label><div class="sk-toggleable__content"><pre>KMeans(n_clusters=3)</pre></div></div></div></div></div>
</div>
</div>
<p>We can then store the labels of the cluster into <code>labels</code> so that it can be used for applying colors to each cluster with the <code>colormap</code> array</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> kmeans.labels_</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>colormap <span class="op">=</span> np.array([<span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Afterwards, we are going to actually plot a scatter graph of the clustered data, using <code>total_attack</code> and <code>total_defense</code> as features</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(X[<span class="st">'Total Attack'</span>], X[<span class="st">'Total Defense'</span>], c<span class="op">=</span>colormap[labels])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pokemon Attack and Defense Clusters'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Total Attack'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Total Defense'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="post2_files/figure-html/cell-9-output-1.png" width="593" height="449"></p>
</div>
</div>
<p>In the above clustering, data points labeled in red are considered “weak”, green are considered “intermediate”, and blue is considered “strong.</p>
<p>I’m going to be replaying Pokemon games over the winter break so I’m hoping this scatter will give me an indication as to what Pokemon I should catch!</p>
</section>
</section>
<section id="gaussian-mixture-models-gmms" class="level1">
<h1>Gaussian Mixture Models (GMMs)</h1>
<p>Gausian Mixture Models (GMMs) are probabilistic models that assumes data points are generated from a mixture of Gaussian distributions. GMMs are a popular clustering algorithm with applications such as density estimation, data compression, and more.</p>
<section id="how-does-gmms-work" class="level2">
<h2 class="anchored" data-anchor-id="how-does-gmms-work">How Does GMMs Work</h2>
<p>A GMM models each cluster as a Gaussian distribuion, characterized by a mean and covariance matrix. The complete model is a weighted sum of the component Gaussian densities.</p>
<p>The GMM fitting process determines the parameters of each Gaussian as well as the mixture weights. This is done through iterative expectation-maximiation algorithm that converges to find the maximum likelihood estimates.</p>
<p>The number of Gaussian components corresponds to the number of clusters. Choosing the right number of clusters is important to avoid underfitting or overfitting.</p>
</section>
<section id="example-of-gmm" class="level2">
<h2 class="anchored" data-anchor-id="example-of-gmm">Example of GMM</h2>
<p>Here we are importing a couple of different libraries that have been used before. We are importing <code>GaussianMixture</code> in order to create Gaussian Mixture Models.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.mixture <span class="im">import</span> GaussianMixture</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This time, I wanted to a different dataset because the one with Pokemon didn’t seem to be creating clusters very well. The dataset being imported consists of customer data, including information such as</p>
<ul>
<li><code>Gender</code></li>
<li><code>Age</code></li>
<li><code>Annual Income ($)</code></li>
<li><code>Spending Score (1-100)</code></li>
<li><code>Profession</code></li>
<li><code>Work Experience</code></li>
<li><code>Family Size</code></li>
</ul>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>customer_data <span class="op">=</span> pd.read_csv(<span class="st">'../../datasets/Customers.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I am particularly interested in using variables that are continuous, which are <code>Age</code>, <code>Annual Income</code>, and <code>Work Experience</code>. We are using these variables as features for segmentation</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>selected_features <span class="op">=</span> [<span class="st">'Age'</span>, <span class="st">'Annual Income ($)'</span>, <span class="st">'Work Experience'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are preprocessing by extracting and scaling the selected features</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>customer_features <span class="op">=</span> customer_data[selected_features]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>customer_features <span class="op">=</span> (customer_features <span class="op">-</span> customer_features.mean()) <span class="op">/</span> customer_features.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create a GMM by creating 3 clusters of the data and then fitting it based on the preprocessed data.</p>
<p>We are then predicting the labels and then assigning it to a column called <code>Cluster</code></p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>gmm <span class="op">=</span> GaussianMixture(n_components<span class="op">=</span>num_clusters)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>gmm.fit(customer_features)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> gmm.predict(customer_features)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>customer_data[<span class="st">'Cluster'</span>] <span class="op">=</span> cluster_labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we plot the data on a scatterplot using <code>Age</code> and <code>Annual Income ($)</code>.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x<span class="op">=</span>customer_data[<span class="st">"Age"</span>], y<span class="op">=</span>customer_data[<span class="st">"Annual Income ($)"</span>], c<span class="op">=</span>cluster_labels, cmap<span class="op">=</span><span class="st">"Set1"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Income"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Customer Segmentation using GMM'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="post2_files/figure-html/cell-15-output-1.png" width="619" height="477"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>